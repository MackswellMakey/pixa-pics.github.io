(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{900:function(t,e,r){function n(t,e){return(t+e|0)>>>0}function o(t,e){return 0|Math.imul(0|t,0|e)}function _(t){return t<<2}function i(t,e){return(t/e|0)>>>0}function s(t){return(t>>2|0)>>>0}function u(t){return(t>>5|0)>>>0}function l(t){return(t>>6|0)>>>0}function c(t){return(t/85-.012|0)>>>0}function h(t){return(t>>7|0)>>>0}function a(t){return 255&(0|t)}function p(t){return 255&(255-t|0)}function f(t){return 255&(t/255|0)}function g(t){return((0|t)<0?0|-t:0|t)>>>0}var y,b,d,x=function(t,e){return 0|Math.imul(0|t,0|e)},w=Math.fround,O=function(t){return 0|x(0|(t|=0),0|t)},P=function(t){var e,r;if(0==(0|(t=(0|t)>>>0))||1==(0|t))return 0|t;for(e=1,r=1;(0|r)<=(0|t);)r=((e=(e+1|0)>>>0)*e|0)>>>0;return(e-1|0)>>>0},j=w(.15945),m=w(.5364),k=w(.0722*3/4),U=w(1/4),A=(0|P(255*j*255+255*m*255+255*k*255+255*U*255|0))>>>0,v=(255*j+255*m+255*k+255*U|0)>>>0,M=function z(t,e){if(e=e||0,!(this instanceof z))return new z(t,e);t instanceof Uint8Array?this.storage_uint8_=t:this.storage_uint8_=new Uint8Array("buffer"in t?t.buffer:t,x(e,4))};M.new_of=function(t,e,r,n){var o=new Uint8Array(4);return o[3]=a(t),o[2]=a(e),o[1]=a(r),o[0]=a(n),M(o)},Object.defineProperty(M.prototype,"r",{get:function(){return a(this.storage_uint8_[3])}}),Object.defineProperty(M.prototype,"g",{get:function(){return a(this.storage_uint8_[2])}}),Object.defineProperty(M.prototype,"b",{get:function(){return a(this.storage_uint8_[1])}}),Object.defineProperty(M.prototype,"a",{get:function(){return a(this.storage_uint8_[0])}}),Object.defineProperty(M.prototype,"uint32",{get:function(){return(this.storage_uint8_[3]<<24|this.storage_uint8_[2]<<16|this.storage_uint8_[1]<<8|this.storage_uint8_[0])>>>0}}),Object.defineProperty(M.prototype,"rgbaon4bits",{get:function(){return(h(this.storage_uint8_[3])<<3|h(this.storage_uint8_[2])<<2|h(this.storage_uint8_[1])<<1|h(this.storage_uint8_[0])<<0|0)>>>0}}),Object.defineProperty(M.prototype,"rgbaon6bits",{get:function(){return((16^c(this.storage_uint8_[3]))+(8^c(this.storage_uint8_[2]))+(4^c(this.storage_uint8_[1]))+(0^c(this.storage_uint8_[0]))|0)>>>0}}),Object.defineProperty(M.prototype,"rgbaon8bits",{get:function(){return(l(this.storage_uint8_[3])<<6|l(this.storage_uint8_[2])<<4|l(this.storage_uint8_[1])<<2|l(this.storage_uint8_[0])<<0|0)>>>0}}),Object.defineProperty(M.prototype,"rgbaon12bits",{get:function(){return(u(this.storage_uint8_[3])<<9|u(this.storage_uint8_[2])<<6|u(this.storage_uint8_[1])<<3|u(this.storage_uint8_[0])<<0|0)>>>0}}),Object.defineProperty(M.prototype,"offset",{get:function(){return s(this.storage_uint8_.byteOffset)}}),Object.defineProperty(M.prototype,"buffer",{get:function(){return this.storage_uint8_.buffer.slice(this.storage_uint8_.byteOffset,n(this.storage_uint8_.byteOffset,4))}}),Object.defineProperty(M.prototype,"subarray",{get:function(){return this.storage_uint8_.subarray(0,4)}}),Object.defineProperty(M.prototype,"set",{get:function(){return function(t){t instanceof M?this.storage_uint8_.set(new Uint8Array(t.buffer)):"subarray"in t?this.storage_uint8_.set(t.subarray(0,4)):this.storage_uint8_.set(t)}}}),Object.defineProperty(M.prototype,"slice",{get:function(){return function(t,e){return this.storage_uint8_.slice(t,e)}}}),M.prototype.is_fully_transparent=function(){return 0==(0|this.a)},M.prototype.is_not_fully_transparent=function(){return 0!=(0|this.a)},M.prototype.simplify=function(t){var e=Uint8Array.of(o(i(this.a,t),t),o(i(this.b,t),t),o(i(this.g,t),t),o(i(this.r,t),t));return this.set(e),this},M.prototype.blend_with=function(t,e,r,o){if(r|=0,o|=0,t.multiply_a_1000(0|e),0!=(0|r))this.is_fully_transparent()?t.set(ArrayBuffer(4)):t.is_fully_transparent()&&this.set(ArrayBuffer(4));else{var _=0!=(0|o)?i(n(this.a,t.a),2):p(f(x(p(t.a),p(this.a))));this.set(M.merge_scale_of_255_a_fixed(t,i(x(t.a,255),_),this,f(x(this.a,i(x(p(t.a),255),_))),_)),t.set(this)}},M.prototype.euclidean_match_with=function(t,e){return 1e3==(0|(e=(0|e)>>>0))||(0==(0|e)?(0|this.uint32)==(0|t.uint32):(P(j*O(this.r-t.r|0)+m*O(this.g-t.g|0)+k*O(this.b-t.b|0)+U*O(this.a-t.a|0)|0)/A*1e3|0)<(0|e))},M.prototype.manhattan_match_with=function(t,e){return 1e3==(0|(e=(0|e)>>>0))||(0==(0|e)?(0|this.uint32)==(0|t.uint32):((x(j,g(this.r-t.r|0))+x(m,g(this.g-t.g|0))+x(k,g(this.b-t.b|0))+x(U,g(this.a-t.a|0))|0)/v*1e3|0)<(0|e))},M.prototype.multiply_a_1000=function(t){this.subarray[0]=a(i(x(this.a,t),1e3))},M.prototype.copy=function(t){return M(this.slice(0,4))},M.with_a=function(t,e){var r=t.slice(0,4);return r[0]=a(e),M(r)},M.merge_scale_of_255_a_fixed=function(t,e,r,n,o){return e=a(e),n=a(n),o=a(o),M.merge_with_a_fixed(M.scale_rgb_of_on_255(t,e,e,e),M.scale_rgb_of_on_255(r,n,n,n),o)},M.scale_rgb_of_on_255=function(t,e,r,n){return M(Uint8Array.of(0,f(x(t.b,n)),f(x(t.g,r)),f(x(t.r,e))))},M.merge_with_a_fixed=function(t,e,r){return M(Uint8Array.of(a(r),n(t.b,e.b),n(t.g,e.g),n(t.r,e.r)))},Object.defineProperty((y=function B(t,e,r){if(!(this instanceof B))return new B(t);this.storage_="buffer"in t?t.buffer:t,e|=0,r=0|r||0|this.storage_.byteLength,this.storage_uint8_array_=new Uint8Array(this.storage_,e,r),this.storage_uint32_array_=new Uint32Array(this.storage_,e,s(r))}).prototype,"length",{get:function(){return this.storage_uint32_array_.length}}),Object.defineProperty(y.prototype,"buffer",{get:function(){return this.storage_uint8_array_.buffer}}),Object.defineProperty(y.prototype,"buffer_setUint8",{get:function(){return function(t,e){return t|=0,e|=0,this.storage_uint8_array_[t]=a(e)}}}),Object.defineProperty(y.prototype,"buffer_getUint8",{get:function(){return function(t){return t|=0,this.storage_uint8_array_[t]}}}),Object.defineProperty(y.prototype,"buffer_getUint8a",{get:function(){return function(t,e){return e=n(t|=0,_(e=(e|=0)||1)),this.storage_uint8_array_.subarray(t,e)}}}),Object.defineProperty(y.prototype,"buffer_setUint32",{get:function(){return function(t,e){this.storage_uint32_array_[0|t]=function(t){return(0|t)>>>0>>>0}(e)}}}),Object.defineProperty(y.prototype,"buffer_getUint32",{get:function(){return function(t){return this.storage_uint32_array_[0|t]}}}),Object.defineProperty(y.prototype,"subarray_uint32",{get:function(){return function(t,e){return t|=0,e=(e|=0)||this.length,this.storage_uint32_array_.subarray(t,e)}}}),Object.defineProperty(y.prototype,"slice_uint32",{get:function(){return function(t,e){return t|=0,e=(e|=0)||this.length,this.storage_uint32_array_.slice(t,e)}}}),Object.defineProperty(y.prototype,"subarray_uint8",{get:function(){return function(t,e){return t|=0,e|=0,this.storage_uint8_array_.subarray(_(t),_(e))}}}),Object.defineProperty(y.prototype,"slice_uint8",{get:function(){return function(t,e){return t|=0,e|=0,this.storage_uint8_array_.slice(_(t),_(e))}}}),y.prototype.get_element=function(t){return M(this.buffer,0|t)},y.prototype.subarray=function(t,e){return t|=0,e|=0,this.buffer_getUint8a(t,e)},Object.defineProperty((b=function J(t){if(t=t||{},!(this instanceof J))return new J(t);t.pxl_colors=t.pxl_colors||new Uint32Array(0),t.pxls=t.pxls||new Uint32Array(0),this.new_pxls_="buffer"in t.pxls?new Uint32Array(t.pxls.buffer):Uint32Array.from(t.pxls),this.new_pxl_colors_="buffer"in t.pxl_colors?y(t.pxl_colors.buffer):y(Uint32Array.from(t.pxl_colors)),this.is_bucket_threshold_auto_=!!(t.bucket_threshold>1e3),t.bucket_threshold=t.bucket_threshold||0,t.bucket_threshold=(0|t.bucket_threshold)>=1?0|t.bucket_threshold:t.this_state_bucket_threshold||0,this.bucket_threshold_=this.is_bucket_threshold_auto_?1:t.bucket_threshold,this.threshold_steps_=this.is_bucket_threshold_auto_?1:3,this.best_color_number_=this.new_pxl_colors_.length/2+t.color_number_bonus|0,this.max_cluster_=this.new_pxl_colors_.length>16384?4097:this.new_pxl_colors_.length>8192?257:this.new_pxl_colors_.length>2048?65:this.new_pxl_colors_.length>512?17:1,this.index_clusters_=Array(this.max_cluster_),this.length_clusters_=new Uint32Array(this.max_cluster_),this.pxl_colors_usage_=new Uint32Array(this.new_pxl_colors_.length),this.all_index_clusters_=new Uint32Array(this.new_pxl_colors_.length),this.clean_pxl_colors_=new Uint32Array(this.new_pxl_colors_.length),this.clean_pxl_colors_lookup_={}}).prototype,"reset_deduplicate",{get:function(){return function(t){this.clean_pxl_colors_lookup_={},this.pxl_colors_usage_.fill(0,0,0|t),this.clean_pxl_colors_.fill(0,0,0|t)}}}),Object.defineProperty(b.prototype,"index_of_color_within_cleaned",{get:function(){return function(t){return(0|this.clean_pxl_colors_lookup_[(0|t)>>>0])-1|0}}}),Object.defineProperty(b.prototype,"set_cleaned_pxl_colors",{get:function(){return function(t,e){this.clean_pxl_colors_[(0|t)>>>0]=(0|e)>>>0,this.clean_pxl_colors_lookup_[(0|e)>>>0]=(t+1|0)>>>0}}}),Object.defineProperty(b.prototype,"increase_color_usage",{get:function(){return function(t){this.pxl_colors_usage_[(0|t)>>>0]=(this.pxl_colors_usage_[(0|t)>>>0]+1|0)>>>0}}}),Object.defineProperty(b.prototype,"set_new_pxls",{get:function(){return function(t,e){this.new_pxls_[(0|t)>>>0]=(0|e)>>>0}}}),Object.defineProperty(b.prototype,"set_new_pxl_colors",{get:function(){return function(t){this.new_pxl_colors_=y(this.clean_pxl_colors_.buffer.slice(0,_(0|t)))}}}),Object.defineProperty(b.prototype,"get_a_new_pxl_color_from_pxl_index",{get:function(){return function(t){return this.new_pxl_colors_.buffer_getUint32(this.new_pxls_[0|t])>>>0}}}),Object.defineProperty(b.prototype,"reset_cluster",{get:function(){return function(){this.max_cluster_=this.new_pxl_colors_.length>16384?4097:this.new_pxl_colors_.length>8192?257:this.new_pxl_colors_.length>2048?65:this.new_pxl_colors_.length>512?17:1,this.length_clusters_.fill(0,0,0|this.max_cluster);for(var t=0;(0|t)<(0|this.max_cluster);t=(t+1|0)>>>0)this.index_clusters_[0|t]=[]}}}),Object.defineProperty(b.prototype,"add_in_indexes_cluster",{get:function(){return function(t,e){this.index_clusters_[(0|t)>>>0].push((0|e)>>>0)}}}),Object.defineProperty(b.prototype,"set_all_cluster_indexes",{get:function(){return function(){var t=0,e=0;for(t=0;(0|t)<(0|this.max_cluster);t=(t+1|0)>>>0)this.all_index_clusters_.set(this.index_clusters_[(0|t)>>>0],(0|e)>>>0),e=(e+this.get_length_in_index_clusters(0|t)|0)>>>0}}}),Object.defineProperty(b.prototype,"get_length_in_index_clusters",{get:function(){return function(t){return(0|this.index_clusters_[(0|t)>>>0].length)>>>0}}}),Object.defineProperty(b.prototype,"get_in_cluster_lengths",{get:function(){return function(t){return(0|this.length_clusters_[(0|t)>>>0])>>>0}}}),Object.defineProperty(b.prototype,"get_an_index_in_clusters",{get:function(){return function(t){return(0|this.all_index_clusters_[0|t])>>>0}}}),Object.defineProperty(b.prototype,"get_a_color_usage",{get:function(){return function(t){return(0|this.pxl_colors_usage_[0|t])>>>0}}}),Object.defineProperty(b.prototype,"set_a_color_usage",{get:function(){return function(t,e){return this.pxl_colors_usage_[0|t]=(0|e)>>>0}}}),Object.defineProperty(b.prototype,"get_a_color_usage_percent",{get:function(){return function(t){return this.pxl_colors_usage_[0|t]/this.new_pxls_.length}}}),Object.defineProperty(b.prototype,"get_average_color_usage_percent",{get:function(){return function(t,e){var r=0,n=0,o=0;for(n=t;(0|n)<(0|e);n=(n+1|0)>>>0)o=(0|this.get_an_index_in_clusters((0|n)>>>0))>>>0,r+=this.pxl_colors_usage_[0|o]/this.new_pxls_.length;return r/(e-t|0)}}}),Object.defineProperty(b.prototype,"get_a_new_pxl_color",{get:function(){return function(t){return this.new_pxl_colors_.get_element(0|t)}}}),Object.defineProperty(b.prototype,"max_cluster",{get:function(){return 0|this.max_cluster_}}),Object.defineProperty(b.prototype,"threshold_steps",{get:function(){return 0|this.threshold_steps_}}),Object.defineProperty(b.prototype,"new_pxls_length",{get:function(){return 0|this.new_pxls_.length}}),Object.defineProperty(b.prototype,"new_pxl_colors_length",{get:function(){return 0|this.new_pxl_colors_.length}}),Object.defineProperty(b.prototype,"best_color_number",{get:function(){return 0|this.best_color_number_}}),Object.defineProperty(b.prototype,"bucket_threshold",{get:function(){return 0|this.bucket_threshold_}}),Object.defineProperty(b.prototype,"is_bucket_threshold_auto",{get:function(){return this.is_bucket_threshold_auto_}}),Object.defineProperty(b.prototype,"set_bucket_threshold",{get:function(){return function(t){this.bucket_threshold_=0|t}}}),Object.defineProperty(b.prototype,"get_data",{get:function(){return function(){return Array.of(this.new_pxls_,this.new_pxl_colors_.slice_uint32(0,this.new_pxl_colors_.length))}}}),b.prototype.output=function(t){var e,r;return t=t||"heap",e=this.get_data(),"heap"==t?((r=new Uint32Array(2+e[0].length+e[1].length))[0]=(0|e[0].length)>>>0,r[1]=(0|e[1].length)>>>0,r.set(e[0],2),r.set(e[1],2+e[0].length),r.buffer):e},b.prototype.deduplicate=function(){var t,e,r,n,o;for(this.reset_deduplicate(0|this.new_pxl_colors_length),t=0,e=0,r=0,n=0,o=0|this.new_pxls_length;(0|n)<(0|o);n=(n+1|0)>>>0)e=0|this.get_a_new_pxl_color_from_pxl_index(0|n),-1==(0|(r=0|this.index_of_color_within_cleaned(0|e)))&&(this.set_cleaned_pxl_colors(0|t,0|e),r=0|t,t=t+1|0),this.increase_color_usage(0|r),this.set_new_pxls(0|n,0|r);this.set_new_pxl_colors(t)},b.prototype.clusterize=function(){this.reset_cluster();var t=0;if(4097===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon12bits)>>>0,(0|t)>>>0);else if(257===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon8bits)>>>0,(0|t)>>>0);else if(65===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon6bits)>>>0,(0|t)>>>0);else if(17===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon4bits)>>>0,(0|t)>>>0);else if(1===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster(0,(0|t)>>>0);this.set_all_cluster_indexes()},b.prototype.process_threshold=function(t){var e,r,n,o,_,i,s,u,l,c,h,a,p,f,g,y,b,d,x,w,O,P;for(t=(0|t)>>>0,e=this.bucket_threshold*(t/this.threshold_steps)|0,r=t/this.threshold_steps,n=!1,o={},_=0,i=0,l=0,c=0,h=0,a=!1,p=0,f=0,g=0,y=0,b=0,d=0,x=0,w=1,O=!!(this.max_cluster<4097),P=0;(0|P)<(0|this.max_cluster);P=(P+1|0)>>>0){for(i=(_+((0|this.get_length_in_index_clusters(0|P))>>>0)|0)>>>0,O&&(g=this.get_average_color_usage_percent(0|_,0|i)),d=0|_;(0|d)<(0|i);d=(d+1|0)>>>0)if(y=(0|this.get_an_index_in_clusters((0|d)>>>0))>>>0,s=this.get_a_new_pxl_color((0|y)>>>0),(0|(l=(0|this.get_a_color_usage((0|y)>>>0))>>>0))>0&&s.is_not_fully_transparent()){for(O&&(w=(c=this.get_a_color_usage_percent(0|y))<g?1:g/c),o={value:s},x=0|_;(0|x)<(0|i);x=(x+1|0)>>>0)b=(0|this.get_an_index_in_clusters((0|x)>>>0))>>>0,u=this.get_a_new_pxl_color(0|b),(0|(h=(0|this.get_a_color_usage(0|b))>>>0))>0&&u.is_not_fully_transparent()&&(p=1e3&((a=(0|l)>(0|h))?1e3*h/l|0:1e3*l/h|0),f=((e/1e3+e/1e3*(1-(O?(0|p)>500?(p-.6*(p-500)|0)/1e3:(p+.6*(500-p)|0)/1e3:(0|p)/1e3))*r)/(1+r)*1e3|0)>>>0,s.euclidean_match_with(u,(f+f*w|0)/2|0)&&(n=!0,l=(l+h|0)>>>0,this.set_a_color_usage(0|y,0|l),this.set_a_color_usage(0|b,0),O&&(w=(c=this.get_a_color_usage_percent(0|y))<g?1:g/c),o.tail={value:this.get_a_new_pxl_color(0|b)},o=o.tail,a?s.blend_with(u,0|p,!1,!1):u.blend_with(s,0|p,!1,!1)));if(n)for(;void 0!==o;)o.value.set(s),o=o.tail}_=0|i}return n},b.prototype.round=function(){var t,e;if(this.new_pxl_colors_length>4096)for(t=this.new_pxl_colors_.length>65536?8:this.new_pxl_colors_.length>32768?6.4:this.new_pxl_colors_.length>16384?4.8:this.new_pxl_colors_.length>8192?3.2:this.new_pxl_colors_.length>4096?1.6:1,e=0;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.get_a_new_pxl_color((0|e)>>>0).simplify(t)},b.prototype.init=function(){return this.round(),this.deduplicate(),this.clusterize(),this},b.prototype.run=function(){for(var t,e=!1,r=!1;!e;){for(t=1;(0|t)<=(0|this.threshold_steps);t=(t+1|0)>>>0)r&&(this.deduplicate(),this.clusterize()),r=this.process_threshold(0|t);if(r&&this.deduplicate(),!this.is_bucket_threshold_auto&&this.bucket_threshold>this.threshold_steps)e=!0;else if(this.new_pxl_colors_length<this.best_color_number)break;this.set_bucket_threshold(this.bucket_threshold+5|0)}return this},d=function(t,e,r,n,o,_){return new Promise((function(i){var s,u,l,c,h,a=new Uint32Array(t.data.subarray(0,t.data.length).reverse().buffer).reverse(),p=1,f=new Uint32Array(a.length),g=new Uint32Array(a.length);for(s=0,u=-1;(0|s)<(0|a.length);s=(s+1|0)>>>0,u=0|f.indexOf(0|a[0|s]))-1==(0|u)&&(f[0|p]=0|a[0|s],u=(0|p)>>>0,p=(p+1|0)>>>0),g[0|s]=(0|u)>>>0;for(Date.now(),c=(l=b({pxls:g,pxl_colors:f.slice(0,p),bucket_threshold:e,threshold_steps:r,color_number_bonus:n,best_color_number:o,this_state_bucket_threshold:_}).init().run().output("split"))[0],h=l[1],g=new Uint32Array(l[0].length).fill(0),s=0;(0|s)<(0|g.length);s=(s+1|0)>>>0)g[0|s]=(0|h[0|c[0|s]])>>>0;t.data.set(new Uint8Array(g.reverse().buffer).reverse()),i(t)}))},t.exports={QuantiMatGlobal:d,QuantiMat:b}}}]);